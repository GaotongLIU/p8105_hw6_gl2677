p8105\_hw6\_gl2677
================
Gaotong LIU
11/18/2019

## Problem 1

``` r
birthweight = read_csv("data/birthweight.csv") %>% 
  mutate(babysex = as.factor(babysex),
         frace  = as.factor(frace),
         malform = as.factor(malform),
         mrace = as.factor(mrace))
```

``` r
my_fit = lm(bwt ~ babysex + blength + gaweeks + bhead,
            data = birthweight)
birthweight %>% 
  add_residuals(my_fit) %>% 
  add_predictions(my_fit) %>% 
  ggplot(aes(x = pred, y = resid)) +
  geom_point() +
  geom_line(aes(y = 0),  color = "red")
```

<img src="p8105_hw6_gl2677_files/figure-gfm/residual plot-1.png" width="90%" />

``` r
birthweight %>% 
  add_residuals(initial_fit) %>% 
  add_predictions(initial_fit) %>% 
  ggplot(aes(x = pred, y = resid)) +
  geom_point() +
  geom_line(aes(y = 0),  color = "red")
```

<img src="p8105_hw6_gl2677_files/figure-gfm/residual plot-2.png" width="90%" />

Firsty I used anava Global F test to find the predictors with
significant effect on the birthweight. 12 variables show the
significance. Then base on the common sense, and to make the model
simpler, I only choose 4 variables which are highly associated with the
birthweight. The model I use only contain the main effect of the baby’s
sex, baby’s length at birth, baby’s head circumference at birth
(centimeters) and gestational age in weeks.

``` r
fit1 = lm(bwt ~ blength + gaweeks, data = birthweight)
fit2 = lm(bwt ~ bhead * blength * babysex, data = birthweight)
```

``` r
cv_df = 
  crossv_mc(birthweight, 100, test = 0.2) %>%
  mutate(
    train = map(train, as_tibble),
    test = map(test, as_tibble)) %>% 
  mutate(
    fit1_model = map(.x = train, ~lm(bwt ~ blength + gaweeks, 
                                     data = .x)),
    fit2_model = map(.x = train, ~lm(bwt ~ bhead * blength * babysex, 
                                     data = .x)),
    my_fit_model = map(.x = train, ~lm(bwt ~ babysex + blength + gaweeks + bhead + mheight,
                                     data = .x))
    ) %>% 
    mutate(
    rmse_fit1 = map2(.x = fit1_model, .y = test, ~rmse(.x, .y)),
    rmse_fit2 = map2(.x = fit2_model, .y = test, ~rmse(.x, .y)),
    rmse_my_fit = map2(.x = my_fit_model, .y = test, ~rmse(.x, .y))
  )
```
